---
import { server } from '@/actions';

let message = '';
let messageType: 'error' | 'success' = 'error';

if (Astro.request.method === 'POST') {
    try {
        const formData = await Astro.request.formData();
        const { data, error } = await Astro.callAction(server.auth.login, formData);
        
        if (data?.success) {
            return Astro.redirect('/dashboard');  // Redirect on successful login
        } else if (error) {
            message = error.message;
            messageType = 'error';
        }
    } catch (error) {
        console.error('Login error:', error);
        message = 'Something went wrong. Please try again.';
        messageType = 'error';
    }
}
---

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Login</title>
    <style>
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Login</h1>
    
    <form method="POST">
        <div>
            <label for="username">Username:</label><br/>
            <input type="text" id="username" name="username" required>
        </div>
        
        <div>
            <label for="password">Password:</label><br/>
            <input type="password" id="password" name="password" required>
        </div>
        
        <div>
            <button type="submit">Login</button>
        </div>
    </form>

    {message && <p class={messageType}>{message}</p>}
</body>
</html> 